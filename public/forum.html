<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Forum Communautaire - MangaWatch</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link rel="stylesheet" href="/css/header-unified-new.css">
    <link rel="stylesheet" href="/css/forum.css">
    <link rel="stylesheet" href="/css/footer-unified.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Garamond:wght@400;500;600;700&family=Times+New+Roman:wght@400;700&family=Orbitron:wght@400;500;600;700;800;900&display=swap" rel="stylesheet">
    <script src="https://accounts.google.com/gsi/client" async defer></script>
    <script src="/js/localization.js"></script>
</head>
<body>
    <!-- En-tête unifié -->
    <header class="main-header">
        <a href="acceuil.html" class="logo-link">
            <img src="/images/kame_house.png" alt="Logo MangaWatch" class="logo-image">
            <span>MangaWatch</span>
        </a>
        
        <form class="search-bar" id="searchForm">
            <input type="text" placeholder="Rechercher un anime ou un manga..." id="searchInput">
            <button type="submit" aria-label="Rechercher">
                <i class="fas fa-search"></i>
            </button>
        </form>
        
        <!-- Navigation desktop (visible sur grand écran) -->
        <nav class="nav-links">
            <a href="acceuil.html" data-i18n="nav.home">Accueil</a>
            <a href="manga-database.html" data-i18n="nav.manga_anime">Mangas & Anime</a>
            <a href="profil.html" data-i18n="nav.profile">Profil</a>
        </nav>
        
        <!-- Bouton hamburger pour mobile -->
        <button class="hamburger-btn" aria-label="Menu">
            <span></span>
            <span></span>
            <span></span>
        </button>
        
        <!-- Avatar utilisateur -->
        <a href="profil.html" class="avatar-link">
            <img id="user-avatar" src="/images/default-avatar.png" alt="Avatar utilisateur" class="user-avatar">
        </a>
    </header>

    <!-- Menu mobile -->
    <div class="mobile-menu">
        <nav class="nav-links">
            <a href="acceuil.html">
                <i class="fas fa-home"></i>
                <span data-i18n="nav.home">Accueil</span>
            </a>
            <a href="manga-database.html">
                <i class="fas fa-tv"></i>
                <span data-i18n="nav.manga_anime">Manga Anime</span>
            </a>
            <a href="list.html">
                <i class="fas fa-bookmark"></i>
                <span data-i18n="nav.collection">Collection</span>
            </a>
            <a href="profil.html">
                <i class="fas fa-user"></i>
                <span data-i18n="nav.profile">Profil</span>
            </a>
            <a href="tierlist.html">
                <i class="fas fa-list-ol"></i>
                <span data-i18n="nav.tierlist">Tier List</span>
            </a>
            <a href="forum.html" class="active">
                <i class="fas fa-comments"></i>
                <span data-i18n="nav.forum">Forum</span>
            </a>
        </nav>
    </div>

    <!-- Bannière du forum -->
    <section class="forum-header">
        <div class="container">
            <h1 data-i18n="forum.title">Forum Communautaire</h1>
            <p data-i18n="forum.subtitle">Rejoignez la discussion, partagez vos avis et découvrez de nouvelles œuvres !</p>
            <button id="newTopicBtn" class="btn btn-primary">
                <i class="fas fa-plus"></i> <span data-i18n="forum.new_topic">Nouveau sujet</span>
            </button>
        </div>
    </section>

    <!-- Contenu principal -->
    <main class="container forum-container">
        <div class="forum-sidebar">
            <div class="sidebar-widget">
                <h3 data-i18n="forum.categories">Catégories</h3>
                <ul class="category-list">
                    <li class="active"><a href="#" data-i18n="forum.category.all">Tous les sujets</a></li>
                    <li><a href="#" data-i18n="forum.category.news">Actualités</a></li>
                    <li><a href="#" data-i18n="forum.category.manga">Mangas</a></li>
                    <li><a href="#" data-i18n="forum.category.anime">Animes</a></li>
                    <li><a href="#" data-i18n="forum.category.debate">Débats</a></li>
                    <li><a href="#" data-i18n="forum.category.help">Aide</a></li>
                </ul>
            </div>
            <div class="sidebar-widget">
                <h3 data-i18n="forum.rules.title">Règles du forum</h3>
                <ol class="rules-list">
                    <li data-i18n="forum.rules.respect">Soyez respectueux envers les autres membres</li>
                    <li data-i18n="forum.rules.content">Pas de contenu inapproprié</li>
                    <li data-i18n="forum.rules.copyright">Respectez le droit d'auteur</li>
                    <li data-i18n="forum.rules.spam">Pas de spam ou de publicité</li>
                    <li data-i18n="forum.rules.on_topic">Restez dans le sujet des discussions</li>
                </ol>
            </div>
        </div>

        <div class="forum-content">
            <!-- Barre de recherche et de tri -->
            <div class="forum-toolbar">
                <div class="search-box">
                    <i class="fas fa-search"></i>
                    <input type="text" id="searchInput" data-i18n-placeholder="forum.search_placeholder">
                </div>
                <div class="sort-options">
                    <span data-i18n="forum.sort_by">Trier par :</span>
                    <select id="sortSelect">
                        <option value="recent" data-i18n="forum.sort.recent">Plus récent</option>
                        <option value="popular" data-i18n="forum.sort.popular">Plus populaire</option>
                        <option value="views" data-i18n="forum.sort.views">Plus de vues</option>
                        <option value="replies" data-i18n="forum.sort.replies">Plus de réponses</option>
                    </select>
                </div>
            </div>

            <!-- Liste des sujets -->
            <div class="topics-list" id="topicsList">
                <!-- Les sujets seront chargés dynamiquement ici -->
                <div class="no-topics">
                    <i class="far fa-comment-dots"></i>
                    <p data-i18n="forum.no_topics">Aucun sujet n'a été créé pour le moment.</p>
                    <button class="btn btn-primary" id="createFirstTopic" data-i18n="forum.create_first">Créer le premier sujet</button>
                </div>
            </div>

            <!-- Pagination -->
            <div class="pagination">
                <button class="btn btn-outline" disabled><i class="fas fa-chevron-left"></i> <span data-i18n="pagination.previous">Précédent</span></button>
                <span data-i18n="pagination.page">Page</span> 1 <span data-i18n="pagination.of">sur</span> 1</span>
                <button class="btn btn-outline" disabled><span data-i18n="pagination.next">Suivant</span> <i class="fas fa-chevron-right"></i></button>
            </div>
        </div>
    </main>

    <!-- Modal Nouveau Sujet -->
    <!-- Bouton de connexion Google (caché par défaut) -->
    <div id="google-signin" style="display: none;"></div>
    
    <div class="modal" id="newTopicModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 data-i18n="forum.modal.new_topic">Nouveau sujet</h2>
                <button class="close-modal">&times;</button>
            </div>
            <div class="modal-body">
                <form id="newTopicForm">
                    <div class="form-group">
                        <label for="topicTitle" data-i18n="forum.modal.title">Titre du sujet</label>
                        <input type="text" id="topicTitle" required>
                    </div>
                    <div class="form-group">
                        <label for="topicCategory" data-i18n="forum.modal.category">Catégorie</label>
                        <select id="topicCategory" required>
                            <option value="" data-i18n="forum.modal.select_category">Sélectionnez une catégorie</option>
                            <option value="news" data-i18n="forum.category.news">Actualités</option>
                            <option value="manga" data-i18n="forum.category.manga">Mangas</option>
                            <option value="anime" data-i18n="forum.category.anime">Animes</option>
                            <option value="debate" data-i18n="forum.category.debate">Débats</option>
                            <option value="help" data-i18n="forum.category.help">Aide</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="topicContent" data-i18n="forum.modal.content">Contenu</label>
                        <textarea id="topicContent" rows="8" required></textarea>
                    </div>
                    <div class="form-actions">
                        <button type="button" class="btn btn-outline" id="cancelTopic" data-i18n="forum.modal.cancel">Annuler</button>
                        <button type="submit" class="btn btn-primary" data-i18n="forum.modal.publish">Publier</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Chargement unique des modules ES -->
    <script>
      // Marquer que nous sommes dans un module
      window.isModule = true;
    </script>
    <script type="module">
      // Importer et initialiser le forum
      import { initForum, attachEventHandlers } from '/js/forum.js';
      // Initialiser le forum une seule fois
      document.addEventListener('DOMContentLoaded', async () => {
        if (!window.forumInitialized) {
          console.log('[Forum] Initialisation du module...');
          window.forumInitialized = true;
          await initForum();
          attachEventHandlers();
          console.log('[Forum] Initialisation terminée');
        }
      });
    </script>
    
    <!-- Script pour la gestion de l'avatar utilisateur -->
    <script src="/js/forum-avatar.js"></script>
    <script src="/js/hamburger-menu.js"></script>
    
    <script>
        // Initialiser la localisation
        document.addEventListener('DOMContentLoaded', function() {
            window.localization.init();
        });
        
        // Gestion de la réponse Google Sign-In
        document.addEventListener('DOMContentLoaded', function() {
            // Gestionnaire de réponse Google Sign-In
            function handleCredentialResponse(response) {
                try {
                    const responsePayload = JSON.parse(atob(response.credential.split('.')[1]));
                    
                    const user = {
                        name: responsePayload.name,
                        email: responsePayload.email,
                        picture: responsePayload.picture,
                        token: response.credential
                    };
                    
                    localStorage.setItem('user', JSON.stringify(user));
                    window.location.reload();
                } catch (error) {
                    console.error('Erreur lors de la connexion Google:', error);
                }
            }
            
            // Exposer la fonction de gestion de la réponse Google
            window.handleCredentialResponse = handleCredentialResponse;
            
            // Gestion du formulaire de recherche
            const searchForm = document.getElementById('searchForm');
            if (searchForm) {
                searchForm.addEventListener('submit', function(e) {
                    e.preventDefault();
                    const searchInput = document.getElementById('searchInput');
                    const searchTerm = searchInput ? searchInput.value.trim() : '';
                    if (searchTerm) {
                        window.location.href = 'recherche.html?q=' + encodeURIComponent(searchTerm);
                    }
                });
            }
        });
    </script>

    <!-- Pied de page minimaliste -->
    <!-- Footer unifié MangaWatch -->
    <footer class="footer-unified">
        <div class="footer-container">
            <!-- Copyright à gauche -->
            <div class="footer-copyright-text">
                <span class="footer-copyright">&copy;</span>2025
                Tous droits réservés &bull; <span class="footer-brand">MangaWatch</span>
                <a href="https://www.msf.fr/donner-palestine" target="_blank" rel="noopener" title="Faire un don pour la Palestine - Médecins Sans Frontières">
                    <img src="/images/Flag_of_Palestine.png" alt="Drapeau Palestine - Faire un don MSF" class="palestine-flag">
                </a>
            </div>
            
            <!-- Réseaux sociaux au centre -->
            <div class="footer-social-links">
                <a href="https://discord.gg/aG8fYmC9" target="_blank" rel="noopener" class="footer-social-icon">
                    <i class="fab fa-discord"></i>
                </a>
                <a href="https://instagram.com/mangawatchofficial" target="_blank" rel="noopener" class="footer-social-icon">
                    <i class="fab fa-instagram"></i>
                </a>
                <a href="https://tiktok.com/@mangawatchofficial" target="_blank" rel="noopener" class="footer-social-icon">
                    <i class="fab fa-tiktok"></i>
                </a>
            </div>
            
            <!-- Pseudos à droite -->
            <div class="footer-authors">
                Made by <a href="user-profile.html?pseudo=katty-perry" class="footer-brand" style="color:inherit;text-decoration:none;">matazziz</a>
            </div>
        </div>
    </footer>
</body>
</html>
