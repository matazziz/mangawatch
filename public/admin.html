<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Administration - Gestion des badges certifi√©s</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link rel="stylesheet" href="/css/header-unified-new.css">
    <link rel="stylesheet" href="/css/footer-unified.css">
    <link rel="stylesheet" href="/css/messaging.css">
    <style>
        body {
            font-family: 'Inter', 'SF Pro Display', -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif;
            background: #0a0e27;
            color: #f5f6fa;
            min-height: 100vh;
            padding-top: 80px;
        }
        
        .admin-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 2rem;
        }
        
        .admin-header {
            text-align: center;
            margin-bottom: 3rem;
        }
        
        .admin-header h1 {
            font-size: 2.5rem;
            margin-bottom: 0.5rem;
            color: #00b894;
            text-shadow: 0 0 20px rgba(0, 184, 148, 0.3);
        }
        
        .admin-header p {
            color: #aaa;
            font-size: 1.1rem;
        }
        
        .admin-section {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            padding: 2rem;
            margin-bottom: 2rem;
        }
        
        .admin-section h2 {
            font-size: 1.5rem;
            margin-bottom: 1.5rem;
            color: #00b894;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .user-search {
            margin-bottom: 2rem;
            position: relative;
        }
        
        .user-search-wrapper {
            position: relative;
            display: flex;
            align-items: center;
        }
        
        .user-search input {
            width: 100%;
            padding: 1rem 3rem 1rem 1rem;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 8px;
            color: #f5f6fa;
            font-size: 1rem;
        }
        
        .user-search input::placeholder {
            color: #888;
        }
        
        .user-search input:focus {
            outline: none;
            border-color: #00b894;
            box-shadow: 0 0 10px rgba(0, 184, 148, 0.3);
        }
        
        .user-search-clear {
            position: absolute;
            right: 12px;
            background: transparent;
            border: none;
            color: #888;
            cursor: pointer;
            padding: 8px;
            display: none;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            transition: all 0.2s;
            width: 32px;
            height: 32px;
        }
        
        .user-search-clear:hover {
            background: rgba(255, 255, 255, 0.1);
            color: #fff;
        }
        
        .user-search-clear.visible {
            display: flex;
        }
        
        .users-list {
            display: grid;
            gap: 1rem;
        }
        
        .user-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 1rem;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            transition: all 0.3s ease;
        }
        
        .user-item:hover {
            background: rgba(255, 255, 255, 0.08);
        }
        
        /* Styles pour les signalements */
        .reports-list {
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }
        
        .report-item {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-left: 4px solid #e17055;
            border-radius: 8px;
            padding: 1.5rem;
            transition: all 0.3s ease;
        }
        
        .report-item:hover {
            background: rgba(255, 255, 255, 0.08);
            border-left-color: #d63031;
        }
        
        .report-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 1rem;
        }
        
        .report-info {
            flex: 1;
        }
        
        .report-user {
            font-weight: 600;
            color: #00b894;
            margin-bottom: 0.25rem;
        }
        
        .report-meta {
            font-size: 0.85rem;
            color: #aaa;
            margin-bottom: 0.5rem;
        }
        
        .report-reason {
            display: inline-block;
            padding: 0.3rem 0.8rem;
            background: rgba(225, 112, 85, 0.2);
            border: 1px solid rgba(225, 112, 85, 0.3);
            border-radius: 12px;
            font-size: 0.85rem;
            color: #e17055;
            margin-top: 0.5rem;
        }
        
        .report-comment-text {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            padding: 0.75rem;
            margin-top: 0.75rem;
            color: #ccc;
            font-size: 0.9rem;
            line-height: 1.5;
        }
        
        .report-actions-admin {
            display: flex;
            gap: 0.75rem;
            margin-top: 1rem;
        }
        
        .ban-btn {
            padding: 0.6rem 1.2rem;
            background: linear-gradient(135deg, #e17055 0%, #d63031 100%);
            border: none;
            border-radius: 8px;
            color: white;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.9rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .ban-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(225, 112, 85, 0.4);
        }
        
        .ban-btn.banned {
            background: linear-gradient(135deg, #636e72 0%, #2d3436 100%);
            cursor: not-allowed;
        }
        
        .ban-btn.banned:hover {
            transform: none;
            box-shadow: none;
        }
        
        .ignore-btn {
            padding: 0.6rem 1.2rem;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 8px;
            color: #fff;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.9rem;
        }
        
        .ignore-btn:hover {
            background: rgba(255, 255, 255, 0.15);
            border-color: rgba(255, 255, 255, 0.3);
        }

        .warn-btn {
            padding: 0.6rem 1.2rem;
            background: linear-gradient(135deg, #f39c12 0%, #e67e22 100%);
            border: none;
            border-radius: 8px;
            color: white;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.9rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .warn-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(243, 156, 18, 0.4);
        }

        .thank-btn {
            padding: 0.6rem 1.2rem;
            background: linear-gradient(135deg, #2ecc71 0%, #27ae60 100%);
            border: none;
            border-radius: 8px;
            color: white;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.9rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .thank-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(46, 204, 113, 0.4);
        }
        
        .user-info {
            display: flex;
            align-items: center;
            gap: 1rem;
            flex: 1;
        }
        
        .user-avatar {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            object-fit: cover;
            border: 2px solid #00b894;
        }
        
        .user-details h3 {
            margin: 0;
            font-size: 1.1rem;
            color: #f5f6fa;
        }
        
        .user-details p {
            margin: 0.25rem 0 0 0;
            font-size: 0.9rem;
            color: #aaa;
        }
        
        .verified-badge-preview {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 1.2rem;
            height: 1.2rem;
            background: linear-gradient(135deg, #1DA1F2 0%, #1DA1F2 100%);
            border-radius: 50%;
            color: #ffffff;
            font-size: 0.7rem;
            margin-left: 0.5rem;
        }
        
        .user-actions {
            display: flex;
            align-items: center;
            gap: 1rem;
        }
        
        .verified-status {
            padding: 0.5rem 1rem;
            border-radius: 20px;
            font-size: 0.9rem;
            font-weight: 500;
        }
        
        .verified-status.verified {
            background: rgba(29, 161, 242, 0.2);
            color: #1DA1F2;
            border: 1px solid #1DA1F2;
        }
        
        .verified-status.not-verified {
            background: rgba(255, 255, 255, 0.1);
            color: #aaa;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .toggle-btn {
            padding: 0.75rem 1.5rem;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .toggle-btn.verify {
            background: linear-gradient(135deg, #1DA1F2 0%, #1DA1F2 100%);
            color: white;
        }
        
        .toggle-btn.verify:hover {
            box-shadow: 0 0 20px rgba(29, 161, 242, 0.5);
            transform: translateY(-2px);
        }
        
        .toggle-btn.unverify {
            background: rgba(255, 255, 255, 0.1);
            color: #f5f6fa;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .toggle-btn.unverify:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: translateY(-2px);
        }
        
        .empty-state {
            text-align: center;
            padding: 3rem;
            color: #888;
        }
        
        .empty-state i {
            font-size: 3rem;
            margin-bottom: 1rem;
            opacity: 0.5;
        }
        
        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin-bottom: 2rem;
        }
        
        .stat-card {
            background: rgba(0, 184, 148, 0.1);
            border: 1px solid rgba(0, 184, 148, 0.3);
            border-radius: 8px;
            padding: 1.5rem;
            text-align: center;
        }
        
        /* Styles pour le formulaire de messagerie */
        .message-form-container {
            display: flex;
            flex-direction: column;
            gap: 1.5rem;
        }

        .form-group {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }

        .form-group label {
            color: #f5f6fa;
            font-weight: 500;
            font-size: 0.95rem;
        }

        .form-control {
            padding: 0.75rem;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 8px;
            color: #f5f6fa;
            font-size: 1rem;
            font-family: inherit;
        }

        .form-control:focus {
            outline: none;
            border-color: #00b894;
            box-shadow: 0 0 10px rgba(0, 184, 148, 0.3);
        }

        .form-control::placeholder {
            color: #888;
        }

        textarea.form-control {
            resize: vertical;
            min-height: 120px;
        }

        .form-actions {
            display: flex;
            gap: 1rem;
            justify-content: flex-end;
        }

        .btn-primary {
            padding: 0.75rem 1.5rem;
            background: linear-gradient(135deg, #00b894 0%, #00a085 100%);
            border: none;
            border-radius: 8px;
            color: white;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 1rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(0, 184, 148, 0.4);
        }

        .btn-secondary {
            padding: 0.75rem 1.5rem;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 8px;
            color: #f5f6fa;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 1rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .btn-secondary:hover {
            background: rgba(255, 255, 255, 0.15);
            border-color: rgba(255, 255, 255, 0.3);
        }

        .message-templates {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }

        .template-btn {
            padding: 0.75rem;
            background: rgba(0, 184, 148, 0.1);
            border: 1px solid rgba(0, 184, 148, 0.3);
            border-radius: 8px;
            color: #00b894;
            cursor: pointer;
            font-size: 0.9rem;
            transition: all 0.2s;
            text-align: left;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .template-btn:hover {
            background: rgba(0, 184, 148, 0.2);
            border-color: rgba(0, 184, 148, 0.5);
            transform: translateX(5px);
        }

        .stat-card h3 {
            font-size: 2rem;
            margin: 0;
            color: #00b894;
        }
        
        .stat-card p {
            margin: 0.5rem 0 0 0;
            color: #aaa;
        }
        
        /* Popup de confirmation personnalis√© */
        .custom-modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.75);
            backdrop-filter: blur(8px);
            -webkit-backdrop-filter: blur(8px);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 10000;
            opacity: 0;
            transition: opacity 0.3s ease;
        }
        
        .custom-modal-overlay.active {
            display: flex;
            opacity: 1;
        }
        
        .custom-modal {
            background: linear-gradient(135deg, #1a1d2e 0%, #23262f 100%);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 20px;
            padding: 2.5rem;
            max-width: 500px;
            width: 90%;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5),
                        0 0 40px rgba(0, 184, 148, 0.2);
            transform: scale(0.9);
            transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
        }
        
        .custom-modal-overlay.active .custom-modal {
            transform: scale(1);
        }
        
        .custom-modal::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, #1DA1F2, #00b894, #1DA1F2);
            background-size: 200% 100%;
            animation: shimmer 3s infinite;
        }
        
        @keyframes shimmer {
            0% { background-position: 200% 0; }
            100% { background-position: -200% 0; }
        }
        
        .custom-modal-header {
            display: flex;
            align-items: center;
            gap: 1rem;
            margin-bottom: 1.5rem;
        }
        
        .custom-modal-icon {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            flex-shrink: 0;
        }
        
        .custom-modal-icon.warning {
            background: linear-gradient(135deg, rgba(255, 107, 107, 0.2), rgba(255, 107, 107, 0.1));
            color: #ff6b6b;
            border: 2px solid rgba(255, 107, 107, 0.3);
        }

        .custom-modal-icon.success {
            background: linear-gradient(135deg, rgba(0, 184, 148, 0.2), rgba(0, 184, 148, 0.1));
            color: #00b894;
            border: 2px solid rgba(0, 184, 148, 0.3);
        }
        
        .custom-modal-title {
            font-size: 1.5rem;
            font-weight: 700;
            color: #f5f6fa;
            margin: 0;
        }
        
        .custom-modal-body {
            color: #aaa;
            line-height: 1.6;
            margin-bottom: 2rem;
            font-size: 1.05rem;
        }
        
        .custom-modal-body strong {
            color: #00b894;
            font-weight: 600;
        }
        
        .custom-modal-actions {
            display: flex;
            gap: 1rem;
            justify-content: flex-end;
        }
        
        .custom-modal-btn {
            padding: 0.75rem 2rem;
            border: none;
            border-radius: 10px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .custom-modal-btn.cancel {
            background: rgba(255, 255, 255, 0.1);
            color: #f5f6fa;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .custom-modal-btn.cancel:hover {
            background: rgba(255, 255, 255, 0.15);
            transform: translateY(-2px);
        }
        
        .custom-modal-btn.confirm {
            background: linear-gradient(135deg, #ff6b6b 0%, #ee5a6f 100%);
            color: white;
            box-shadow: 0 4px 15px rgba(255, 107, 107, 0.4);
        }
        
        .custom-modal-btn.confirm:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(255, 107, 107, 0.6);
        }
        
        .custom-modal-btn.cancel:hover,
        .custom-modal-btn.confirm:hover {
            transform: translateY(-2px);
        }
    </style>
</head>
<body>
    <!-- En-t√™te unifi√© -->
    <header class="main-header">
        <a href="acceuil.html" class="logo-link">
            <img src="/images/kame_house.png" alt="Logo MangaWatch" class="logo-image">
            <span>MangaWatch</span>
        </a>
        
        <nav class="nav-links">
            <a href="acceuil.html">Accueil</a>
            <a href="profil.html">Retour au profil</a>
        </nav>
        
        <div class="header-right">
            <a href="profil.html" class="avatar-link">
                <img id="user-avatar" src="/images/logo.png" alt="Avatar utilisateur" class="user-avatar" onerror="this.src='/images/logo.png'">
            </a>
        </div>
    </header>

    <div class="admin-container">
        <div class="admin-header">
            <h1><i class="fas fa-shield-alt"></i> Administration</h1>
            <p>Gestion des badges certifi√©s</p>
        </div>

        <div class="stats">
            <div class="stat-card">
                <h3 id="total-users">0</h3>
                <p>Utilisateurs total</p>
            </div>
            <div class="stat-card">
                <h3 id="verified-count">0</h3>
                <p>Utilisateurs certifi√©s</p>
            </div>
        </div>

        <div class="admin-section">
            <h2><i class="fas fa-users"></i> Liste des utilisateurs</h2>
            
            <div class="user-search">
                <div class="user-search-wrapper">
                    <input type="text" id="user-search-input" placeholder="Rechercher un utilisateur par email ou nom...">
                    <button class="user-search-clear" id="user-search-clear" title="Effacer la recherche">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
            </div>
            
            <div class="users-list" id="users-list">
                <div class="empty-state">
                    <i class="fas fa-spinner fa-spin"></i>
                    <p>Chargement des utilisateurs...</p>
                </div>
            </div>
        </div>

        <!-- Section Signalements -->
        <div class="admin-section">
            <h2><i class="fas fa-flag"></i> Signalements des utilisateurs</h2>
            
            <div class="reports-list" id="reports-list">
                <div class="empty-state">
                    <i class="fas fa-spinner fa-spin"></i>
                    <p>Chargement des signalements...</p>
                </div>
            </div>
        </div>

        <!-- Section Messagerie Admin -->
        <div class="admin-section">
            <h2><i class="fas fa-paper-plane"></i> Envoyer un message</h2>
            
            <div class="message-form-container">
                <div class="form-group">
                    <label for="message-recipient-type">Type de destinataire</label>
                    <select id="message-recipient-type" class="form-control">
                        <option value="global">üåç Tous les utilisateurs (Message global)</option>
                        <option value="user">üë§ Utilisateur sp√©cifique</option>
                    </select>
                </div>

                <div class="form-group" id="user-select-group" style="display: none;">
                    <label for="message-recipient-user-search">Rechercher un utilisateur</label>
                    <input type="text" id="message-recipient-user-search" class="form-control" placeholder="Rechercher par nom ou email...">
                    <select id="message-recipient-user" class="form-control" style="margin-top: 0.5rem;">
                        <option value="">Choisir un utilisateur...</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="message-type">Type de message</label>
                    <select id="message-type" class="form-control">
                        <option value="info">‚ÑπÔ∏è Information</option>
                        <option value="warning">‚ö†Ô∏è Avertissement</option>
                        <option value="ban">üö´ Bannissement</option>
                        <option value="thank">‚ù§Ô∏è Remerciement</option>
                        <option value="global">üì¢ Annonce globale</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="message-title">Titre</label>
                    <input type="text" id="message-title" class="form-control" placeholder="Titre du message">
                </div>

                <div class="form-group">
                    <label for="message-content">Contenu</label>
                    <textarea id="message-content" class="form-control" rows="8" placeholder="Contenu du message..."></textarea>
                    <small style="color: #888; font-size: 0.85rem; margin-top: 0.5rem; display: block;">
                        üí° Utilisez les mod√®les pr√©-remplis ci-dessous ou personnalisez votre message
                    </small>
                </div>

                <div class="form-group">
                    <label>Mod√®les de messages pr√©d√©finis</label>
                    <div class="message-templates">
                        <button type="button" class="template-btn" data-template="warning-harassment">
                            <i class="fas fa-exclamation-triangle"></i> Avertissement - Harc√®lement
                        </button>
                        <button type="button" class="template-btn" data-template="warning-spam">
                            <i class="fas fa-exclamation-triangle"></i> Avertissement - Spam
                        </button>
                        <button type="button" class="template-btn" data-template="warning-inappropriate">
                            <i class="fas fa-exclamation-triangle"></i> Avertissement - Contenu inappropri√©
                        </button>
                        <button type="button" class="template-btn" data-template="ban">
                            <i class="fas fa-ban"></i> Bannissement
                        </button>
                        <button type="button" class="template-btn" data-template="thank-report">
                            <i class="fas fa-heart"></i> Remerciement - Signalement
                        </button>
                        <button type="button" class="template-btn" data-template="thank-report-ban">
                            <i class="fas fa-heart"></i> Remerciement - Signalement (Bannissement)
                        </button>
                        <button type="button" class="template-btn" data-template="global-event">
                            <i class="fas fa-bullhorn"></i> Annonce - √âv√©nement
                        </button>
                        <button type="button" class="template-btn" data-template="share-site">
                            <i class="fas fa-share-alt"></i> Partage du site - Certification
                        </button>
                    </div>
                </div>

                <div class="form-actions">
                    <button class="btn-primary" id="send-message-btn">
                        <i class="fas fa-paper-plane"></i> Envoyer le message
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Popup de confirmation personnalis√© -->
    <div class="custom-modal-overlay" id="confirm-modal-overlay">
        <div class="custom-modal">
            <div class="custom-modal-header">
                <div class="custom-modal-icon warning">
                    <i class="fas fa-exclamation-triangle"></i>
                </div>
                <h3 class="custom-modal-title">Retirer la certification</h3>
            </div>
            <div class="custom-modal-body">
                √ätes-vous s√ªr de vouloir retirer la certification de <strong id="confirm-modal-email"></strong> ?
                <br><br>
                Cette action retirera le badge certifi√© de cet utilisateur.
            </div>
            <div class="custom-modal-actions">
                <button class="custom-modal-btn cancel" id="confirm-modal-cancel">
                    <i class="fas fa-times"></i>
                    Annuler
                </button>
                <button class="custom-modal-btn confirm" id="confirm-modal-confirm">
                    <i class="fas fa-check"></i>
                    Confirmer
                </button>
            </div>
        </div>
    </div>

    <!-- Popup de confirmation pour l'envoi de message -->
    <div class="custom-modal-overlay" id="send-message-modal-overlay">
        <div class="custom-modal">
            <div class="custom-modal-header">
                <div class="custom-modal-icon success">
                    <i class="fas fa-paper-plane"></i>
                </div>
                <h3 class="custom-modal-title">Confirmer l'envoi du message</h3>
            </div>
            <div class="custom-modal-body" id="send-message-modal-body">
                <!-- Contenu dynamique -->
            </div>
            <div class="custom-modal-actions">
                <button class="custom-modal-btn cancel" id="send-message-modal-cancel">
                    <i class="fas fa-times"></i>
                    Annuler
                </button>
                <button class="custom-modal-btn confirm" id="send-message-modal-confirm">
                    <i class="fas fa-paper-plane"></i>
                    Envoyer
                </button>
            </div>
        </div>
    </div>

    <!-- Popup pour saisir le message d'avertissement/remerciement -->
    <div class="custom-modal-overlay" id="message-input-modal-overlay">
        <div class="custom-modal">
            <div class="custom-modal-header">
                <div class="custom-modal-icon" id="message-input-modal-icon">
                    <i class="fas fa-exclamation-triangle"></i>
                </div>
                <h3 class="custom-modal-title" id="message-input-modal-title">Envoyer un message</h3>
            </div>
            <div class="custom-modal-body">
                <div style="margin-bottom: 1rem;">
                    <p style="margin-bottom: 0.75rem; color: #aaa;">
                        <strong style="color: #00b894;">Destinataire :</strong><br>
                        <span style="color: #ccc;" id="message-input-recipient"></span>
                    </p>
                </div>
                <div style="margin-bottom: 1rem;">
                    <label for="message-input-textarea" style="display: block; color: #aaa; margin-bottom: 0.5rem; font-weight: 500;">
                        Message :
                    </label>
                    <textarea 
                        id="message-input-textarea" 
                        rows="8" 
                        style="
                            width: 100%;
                            padding: 12px;
                            background: rgba(255, 255, 255, 0.05);
                            border: 2px solid rgba(255, 255, 255, 0.1);
                            border-radius: 8px;
                            color: #f5f6fa;
                            font-family: inherit;
                            font-size: 0.95rem;
                            resize: vertical;
                            box-sizing: border-box;
                        "
                        placeholder="Entrez votre message ici..."></textarea>
                </div>
            </div>
            <div class="custom-modal-actions">
                <button class="custom-modal-btn cancel" id="message-input-modal-cancel">
                    <i class="fas fa-times"></i>
                    Annuler
                </button>
                <button class="custom-modal-btn confirm" id="message-input-modal-confirm">
                    <i class="fas fa-paper-plane"></i>
                    Envoyer
                </button>
            </div>
        </div>
    </div>

    <script>
        // R√©cup√©rer tous les utilisateurs depuis localStorage
        function getAllUsers() {
            const users = [];
            const accounts = JSON.parse(localStorage.getItem('accounts') || '[]');
            
            // Ajouter les comptes
            accounts.forEach(account => {
                if (account.email) {
                    users.push({
                        email: account.email,
                        name: account.username || account.name || account.email.split('@')[0],
                        avatar: localStorage.getItem('avatar_' + account.email) || null
                    });
                }
            });
            
            // Ajouter les profils sauvegard√©s
            for (let i = 0; i < localStorage.length; i++) {
                const key = localStorage.key(i);
                if (key && key.startsWith('profile_') && !key.startsWith('profile_description_') && !key.startsWith('profile_banner_')) {
                    try {
                        const email = key.replace('profile_', '');
                        // V√©rifier que c'est bien un email (contient @)
                        if (!email.includes('@')) {
                            continue;
                        }
                        
                        const profileData = localStorage.getItem(key);
                        // V√©rifier que les donn√©es commencent par { ou [ (JSON valide)
                        if (!profileData || (!profileData.trim().startsWith('{') && !profileData.trim().startsWith('['))) {
                            continue;
                        }
                        
                        const profile = JSON.parse(profileData);
                        
                        // V√©rifier si l'utilisateur n'est pas d√©j√† dans la liste
                        if (!users.find(u => u.email === email)) {
                            users.push({
                                email: email,
                                name: profile.name || profile.username || email.split('@')[0],
                                avatar: localStorage.getItem('avatar_' + email) || profile.picture || null
                            });
                        }
                    } catch (e) {
                        // Ignorer silencieusement les erreurs de parsing pour √©viter les logs r√©p√©t√©s
                        // Ces erreurs sont normales pour les cl√©s qui ne sont pas du JSON
                    }
                }
            }
            
            return users;
        }
        
        // R√©cup√©rer les utilisateurs certifi√©s
        function getVerifiedUsers() {
            return JSON.parse(localStorage.getItem('verified_users') || '[]');
        }
        
        // Ajouter un utilisateur aux certifi√©s
        function verifyUser(email) {
            const verified = getVerifiedUsers();
            if (!verified.includes(email)) {
                verified.push(email);
                localStorage.setItem('verified_users', JSON.stringify(verified));
                return true;
            }
            return false;
        }
        
        // Retirer un utilisateur des certifi√©s
        function unverifyUser(email) {
            const verified = getVerifiedUsers();
            const index = verified.indexOf(email);
            if (index > -1) {
                verified.splice(index, 1);
                localStorage.setItem('verified_users', JSON.stringify(verified));
                return true;
            }
            return false;
        }
        
        // Afficher les utilisateurs
        function displayUsers(users) {
            const usersList = document.getElementById('users-list');
            const verified = getVerifiedUsers();
            
            if (users.length === 0) {
                usersList.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-user-slash"></i>
                        <p>Aucun utilisateur trouv√©</p>
                    </div>
                `;
                return;
            }
            
            usersList.innerHTML = users.map(user => {
                const isVerified = verified.includes(user.email);
                return `
                    <div class="user-item">
                        <div class="user-info">
                            <img src="${user.avatar || '/images/logo.png'}" alt="${user.name}" class="user-avatar" onerror="this.src='/images/logo.png'">
                            <div class="user-details">
                                <h3>
                                    ${user.name}
                                    ${isVerified ? '<span class="verified-badge-preview"><i class="fas fa-check"></i></span>' : ''}
                                </h3>
                                <p>${user.email}</p>
                            </div>
                        </div>
                        <div class="user-actions">
                            <span class="verified-status ${isVerified ? 'verified' : 'not-verified'}">
                                ${isVerified ? '<i class="fas fa-check-circle"></i> Certifi√©' : 'Non certifi√©'}
                            </span>
                            <button class="toggle-btn ${isVerified ? 'unverify' : 'verify'}" onclick="toggleVerification('${user.email}')">
                                <i class="fas fa-${isVerified ? 'times' : 'check'}"></i>
                                ${isVerified ? 'Retirer la certification' : 'Certifier'}
                            </button>
                        </div>
                    </div>
                `;
            }).join('');
        }
        
        // Afficher le popup de confirmation personnalis√©
        let currentModalCallback = null;
        
        function showConfirmModal(email, userName, callback) {
            const overlay = document.getElementById('confirm-modal-overlay');
            const modalEmail = document.getElementById('confirm-modal-email');
            
            if (!overlay) {
                console.error('Modal overlay non trouv√©');
                // Fallback vers confirm si le modal n'existe pas
                if (confirm(`√ätes-vous s√ªr de vouloir retirer la certification de ${email} ?`)) {
                    callback();
                }
                return;
            }
            
            // Stocker le callback
            currentModalCallback = callback;
            
            // Mettre √† jour l'email affich√©
            if (modalEmail) {
                modalEmail.textContent = email;
            }
            
            // Afficher le modal
            overlay.classList.add('active');
        }
        
        // Initialiser les event listeners du modal (une seule fois)
        let modalListenersInitialized = false;
        
        function initModalListeners() {
            if (modalListenersInitialized) return;
            
            const overlay = document.getElementById('confirm-modal-overlay');
            const confirmBtn = document.getElementById('confirm-modal-confirm');
            const cancelBtn = document.getElementById('confirm-modal-cancel');
            
            if (!overlay || !confirmBtn || !cancelBtn) {
                // R√©essayer plus tard si les √©l√©ments ne sont pas encore charg√©s
                setTimeout(initModalListeners, 100);
                return;
            }
            
            modalListenersInitialized = true;
            
            // Ajouter les listeners
            confirmBtn.addEventListener('click', function(e) {
                e.preventDefault();
                e.stopPropagation();
                if (currentModalCallback) {
                    currentModalCallback();
                    currentModalCallback = null;
                }
                overlay.classList.remove('active');
            });
            
            cancelBtn.addEventListener('click', function(e) {
                e.preventDefault();
                e.stopPropagation();
                currentModalCallback = null;
                overlay.classList.remove('active');
            });
            
            // Fermer en cliquant sur l'overlay
            overlay.addEventListener('click', function(e) {
                if (e.target === overlay) {
                    currentModalCallback = null;
                    overlay.classList.remove('active');
                }
            });
        }
        
        // Initialiser les listeners quand le DOM est pr√™t
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', initModalListeners);
        } else {
            initModalListeners();
        }
        
        // Basculer la certification
        function toggleVerification(email) {
            const verified = getVerifiedUsers();
            const isVerified = verified.includes(email);
            
            if (isVerified) {
                // R√©cup√©rer le nom de l'utilisateur
                const allUsers = getAllUsers();
                const user = allUsers.find(u => u.email === email);
                const userName = user ? user.name : email;
                
                showConfirmModal(email, userName, () => {
                    unverifyUser(email);
                    loadUsers();
                    updateStats();
                    
                    // D√©clencher un √©v√©nement pour mettre √† jour le badge sur les autres pages
                    window.dispatchEvent(new CustomEvent('verifiedUsersUpdated', { detail: { email } }));
                    
                    // Si on est sur la page de profil, mettre √† jour le badge imm√©diatement
                    if (typeof window.updateUserNameDisplay === 'function') {
                        const currentUser = JSON.parse(localStorage.getItem('user') || 'null');
                        if (currentUser && currentUser.email === email) {
                            const userNameText = document.getElementById('user-name-text');
                            if (userNameText) {
                                window.updateUserNameDisplay(userNameText.textContent, email);
                            }
                        }
                    }
                });
            } else {
                verifyUser(email);
                loadUsers();
                updateStats();
                
                // D√©clencher un √©v√©nement pour mettre √† jour le badge sur les autres pages
                window.dispatchEvent(new CustomEvent('verifiedUsersUpdated', { detail: { email } }));
                
                // Si on est sur la page de profil, mettre √† jour le badge imm√©diatement
                if (typeof window.updateUserNameDisplay === 'function') {
                    const currentUser = JSON.parse(localStorage.getItem('user') || 'null');
                    if (currentUser && currentUser.email === email) {
                        const userNameText = document.getElementById('user-name-text');
                        if (userNameText) {
                            window.updateUserNameDisplay(userNameText.textContent, email);
                        }
                    }
                }
            }
        }
        
        // Filtrer les utilisateurs
        function filterUsers(searchTerm) {
            const allUsers = getAllUsers();
            if (!searchTerm) {
                return allUsers;
            }
            
            const term = searchTerm.toLowerCase();
            return allUsers.filter(user => 
                user.email.toLowerCase().includes(term) ||
                user.name.toLowerCase().includes(term)
            );
        }
        
        // Mettre √† jour les statistiques
        function updateStats() {
            const allUsers = getAllUsers();
            const verified = getVerifiedUsers();
            
            document.getElementById('total-users').textContent = allUsers.length;
            document.getElementById('verified-count').textContent = verified.length;
        }
        
        // Charger les utilisateurs
        function loadUsers() {
            const searchTerm = document.getElementById('user-search-input').value;
            const filteredUsers = filterUsers(searchTerm);
            displayUsers(filteredUsers);
        }
        
        // R√©cup√©rer tous les signalements
        function getAllReports() {
            return JSON.parse(localStorage.getItem('user_reports') || '[]');
        }
        
        // R√©cup√©rer les utilisateurs bannis
        function getBannedUsers() {
            return JSON.parse(localStorage.getItem('banned_users') || '[]');
        }
        
        // Bannir un utilisateur
        function banUser(email) {
            const banned = getBannedUsers();
            if (!banned.some(b => b.email === email)) {
                banned.push({
                    email: email,
                    date: new Date().toISOString()
                });
                localStorage.setItem('banned_users', JSON.stringify(banned));
            }
        }
        
        // V√©rifier si un utilisateur est banni
        function isUserBanned(email) {
            const banned = getBannedUsers();
            return banned.some(b => b.email === email);
        }
        
        // Obtenir le texte de la raison en fran√ßais
        function getReasonText(reason) {
            const reasons = {
                'harassment': 'Harc√®lement ou comportement toxique',
                'spam': 'Spam ou publicit√© non sollicit√©e',
                'inappropriate': 'Contenu offensant ou inappropri√©',
                'fake': 'Compte impersonnant quelqu\'un d\'autre',
                'other': 'Autre raison'
            };
            return reasons[reason] || reason;
        }
        
        // Afficher les signalements
        function displayReports() {
            const reports = getAllReports();
            const reportsList = document.getElementById('reports-list');
            const bannedUsers = getBannedUsers();
            
            if (!reportsList) return;
            
            if (reports.length === 0) {
                reportsList.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-flag" style="font-size: 3rem; color: #555; margin-bottom: 1rem;"></i>
                        <p>Aucun signalement pour le moment</p>
                    </div>
                `;
                return;
            }
            
            // Grouper les signalements par utilisateur signal√©
            const reportsByUser = {};
            reports.forEach(report => {
                if (!reportsByUser[report.reportedUser]) {
                    reportsByUser[report.reportedUser] = [];
                }
                reportsByUser[report.reportedUser].push(report);
            });
            
            reportsList.innerHTML = '';
            
            Object.keys(reportsByUser).forEach(userEmail => {
                const userReports = reportsByUser[userEmail];
                const isBanned = isUserBanned(userEmail);
                
                // Obtenir les infos de l'utilisateur
                const profileData = localStorage.getItem('profile_' + userEmail);
                let userName = userEmail;
                let userAvatar = '/images/logo.png';
                
                if (profileData) {
                    try {
                        const profile = JSON.parse(profileData);
                        userName = profile.name || profile.username || userEmail;
                    } catch (e) {
                        console.error('Erreur:', e);
                    }
                }
                
                const avatarKey = 'avatar_' + userEmail;
                const storedAvatar = localStorage.getItem(avatarKey);
                if (storedAvatar) {
                    userAvatar = storedAvatar;
                }
                
                const reportItem = document.createElement('div');
                reportItem.className = 'report-item';
                
                // Compter les raisons
                const reasonCounts = {};
                const allComments = [];
                const reportDates = [];
                const reporters = [];
                
                userReports.forEach(report => {
                    // Compter les raisons
                    if (!reasonCounts[report.reason]) {
                        reasonCounts[report.reason] = 0;
                    }
                    reasonCounts[report.reason]++;
                    
                    // Collecter les commentaires
                    if (report.comment && report.comment.trim()) {
                        allComments.push({
                            comment: report.comment,
                            reporter: report.reportedBy,
                            date: report.date
                        });
                    }
                    
                    // Collecter les dates
                    reportDates.push(new Date(report.date));
                    
                    // Collecter les rapporteurs
                    if (!reporters.includes(report.reportedBy)) {
                        reporters.push(report.reportedBy);
                    }
                });
                
                // Trier les dates pour obtenir la premi√®re et la derni√®re
                reportDates.sort((a, b) => a - b);
                const firstDate = reportDates[0];
                const lastDate = reportDates[reportDates.length - 1];
                const formattedFirstDate = firstDate.toLocaleDateString('fr-FR', {
                    year: 'numeric',
                    month: 'long',
                    day: 'numeric',
                    hour: '2-digit',
                    minute: '2-digit'
                });
                const formattedLastDate = lastDate.toLocaleDateString('fr-FR', {
                    year: 'numeric',
                    month: 'long',
                    day: 'numeric',
                    hour: '2-digit',
                    minute: '2-digit'
                });
                
                // Cr√©er l'affichage des raisons
                let reasonsHtml = '';
                Object.keys(reasonCounts).forEach(reason => {
                    const count = reasonCounts[reason];
                    reasonsHtml += `
                        <span class="report-reason" style="margin-right: 0.5rem; margin-bottom: 0.5rem; display: inline-block;">
                            ${getReasonText(reason)}${count > 1 ? ` (${count})` : ''}
                        </span>
                    `;
                });
                
                // Cr√©er l'affichage des rapporteurs (qui a signal√©)
                let reportersHtml = '';
                if (reporters.length > 0) {
                    reportersHtml = '<div style="margin-top: 1rem;"><strong style="color: #aaa; font-size: 0.9rem; display: block; margin-bottom: 0.5rem;">Signal√© par :</strong>';
                    reporters.forEach((reporterEmail, index) => {
                        // Obtenir les infos du rapporteur
                        const reporterProfileData = localStorage.getItem('profile_' + reporterEmail);
                        let reporterName = reporterEmail;
                        let reporterAvatar = '/images/logo.png';
                        
                        if (reporterProfileData) {
                            try {
                                const reporterProfile = JSON.parse(reporterProfileData);
                                reporterName = reporterProfile.name || reporterProfile.username || reporterEmail;
                            } catch (e) {
                                console.error('Erreur:', e);
                            }
                        }
                        
                        const reporterAvatarKey = 'avatar_' + reporterEmail;
                        const storedReporterAvatar = localStorage.getItem(reporterAvatarKey);
                        if (storedReporterAvatar) {
                            reporterAvatar = storedReporterAvatar;
                        }
                        
                        reportersHtml += `
                            <div style="display: flex; align-items: center; gap: 0.75rem; margin-bottom: 0.5rem; padding: 0.5rem; background: rgba(255,255,255,0.05); border-radius: 8px;">
                                <img src="${reporterAvatar}" alt="${reporterName}" style="
                                    width: 35px;
                                    height: 35px;
                                    border-radius: 50%;
                                    object-fit: cover;
                                    border: 2px solid #00b894;
                                " onerror="this.src='/images/logo.png'">
                                <div>
                                    <div style="color: #f5f6fa; font-size: 0.9rem; font-weight: 500;">${reporterName}</div>
                                    <div style="color: #888; font-size: 0.8rem;">${reporterEmail}</div>
                                </div>
                            </div>
                        `;
                    });
                    reportersHtml += '</div>';
                }
                
                // Cr√©er l'affichage des commentaires
                let commentsHtml = '';
                if (allComments.length > 0) {
                    commentsHtml = '<div style="margin-top: 1rem;"><strong style="color: #aaa; font-size: 0.9rem; display: block; margin-bottom: 0.5rem;">Commentaires :</strong>';
                    allComments.forEach((commentObj, index) => {
                        const commentDate = new Date(commentObj.date);
                        const formattedCommentDate = commentDate.toLocaleDateString('fr-FR', {
                            year: 'numeric',
                            month: 'long',
                            day: 'numeric',
                            hour: '2-digit',
                            minute: '2-digit'
                        });
                        commentsHtml += `
                            <div class="report-comment-text" style="${index > 0 ? 'margin-top: 0.75rem;' : ''}">
                                <div style="font-size: 0.8rem; color: #888; margin-bottom: 0.5rem;">
                                    Par ${commentObj.reporter} le ${formattedCommentDate}
                                </div>
                                ${commentObj.comment}
                            </div>
                        `;
                    });
                    commentsHtml += '</div>';
                }
                
                reportItem.innerHTML = `
                    <div class="report-header">
                        <div class="report-info">
                            <div style="display: flex; align-items: center; gap: 1rem; margin-bottom: 0.5rem;">
                                <img src="${userAvatar}" alt="${userName}" style="
                                    width: 50px;
                                    height: 50px;
                                    border-radius: 50%;
                                    object-fit: cover;
                                    border: 2px solid ${isBanned ? '#e17055' : '#00b894'};
                                " onerror="this.src='/images/logo.png'">
                                <div>
                                    <div class="report-user">${userName}</div>
                                    <div style="font-size: 0.85rem; color: #aaa;">${userEmail}</div>
                                    ${isBanned ? '<div style="color: #e17055; font-size: 0.85rem; margin-top: 0.25rem;"><i class="fas fa-ban"></i> Utilisateur banni</div>' : ''}
                                </div>
                            </div>
                            <div style="margin-top: 0.5rem; color: #aaa; font-size: 0.9rem;">
                                <strong>${userReports.length}</strong> signalement${userReports.length > 1 ? 's' : ''} de <strong>${reporters.length}</strong> personne${reporters.length > 1 ? 's' : ''}
                            </div>
                            <div class="report-meta" style="margin-top: 0.5rem;">
                                ${userReports.length === 1 ? `Signal√© le ${formattedFirstDate}` : `Du ${formattedFirstDate} au ${formattedLastDate}`}
                            </div>
                        </div>
                    </div>
                    <div style="margin-top: 1rem;">
                        <div style="margin-bottom: 0.75rem;">
                            <strong style="color: #aaa; font-size: 0.9rem; display: block; margin-bottom: 0.5rem;">Raisons :</strong>
                            <div>
                                ${reasonsHtml}
                            </div>
                        </div>
                        ${reportersHtml}
                        ${commentsHtml}
                    </div>
                    <div class="report-actions-admin">
                        ${!isBanned ? `
                            <button class="ban-btn" onclick="handleBanUser('${userEmail}', '${userName.replace(/'/g, "\\'")}')">
                                <i class="fas fa-ban"></i>
                                Bannir
                            </button>
                        ` : `
                            <button class="ban-btn banned" disabled>
                                <i class="fas fa-ban"></i>
                                D√©j√† banni
                            </button>
                        `}
                        <button class="warn-btn" onclick="handleWarnUser('${userEmail}', '${userName.replace(/'/g, "\\'")}')">
                            <i class="fas fa-exclamation-triangle"></i>
                            Avertir
                        </button>
                        <button class="thank-btn" onclick="handleThankUser('${userEmail}', '${userName.replace(/'/g, "\\'")}')">
                            <i class="fas fa-heart"></i>
                            Remercier
                        </button>
                        <button class="ignore-btn" onclick="handleIgnoreReport('${userEmail}')">
                            <i class="fas fa-times"></i>
                            Ignorer
                        </button>
                    </div>
                `;
                
                reportsList.appendChild(reportItem);
            });
        }
        
        // G√©rer le bannissement
        async function handleBanUser(email, name) {
            if (confirm(`Voulez-vous vraiment bannir ${name} (${email}) ?\n\nCette action est irr√©versible.`)) {
                banUser(email);
                
                // Envoyer un message de bannissement
                await sendBanMessage(email, name);
                
                displayReports();
                alert(`${name} a √©t√© banni avec succ√®s et un message lui a √©t√© envoy√©.`);
            }
        }
        
        // G√©rer l'avertissement
        async function handleWarnUser(email, name) {
            const defaultMessage = `Bonjour,\n\nVous avez re√ßu un avertissement pour comportement inappropri√© signal√© par d'autres utilisateurs.\n\nVeuillez respecter les r√®gles de la communaut√©.\n\nCordialement, L'√©quipe MangaWatch`;
            showMessageInputModal('warning', email, name, defaultMessage, async (message) => {
                if (message && message.trim()) {
                    await sendWarningMessage(email, name, message);
                    alert(`Avertissement envoy√© √† ${name} avec succ√®s.`);
                }
            });
        }
        
        // G√©rer le remerciement
        async function handleThankUser(email, name) {
            const reports = getAllReports();
            const userReports = reports.filter(r => r.reportedUser === email);
            const reporters = [...new Set(userReports.map(r => r.reportedBy))];
            
            if (reporters.length === 0) {
                alert('Aucun rapporteur trouv√© pour ce signalement.');
                return;
            }
            
            // Obtenir les noms des rapporteurs
            const reportersInfo = reporters.map(reporterEmail => {
                const reporterProfileData = localStorage.getItem('profile_' + reporterEmail);
                let reporterName = reporterEmail;
                if (reporterProfileData) {
                    try {
                        const reporterProfile = JSON.parse(reporterProfileData);
                        reporterName = reporterProfile.name || reporterProfile.username || reporterEmail;
                    } catch (e) {
                        console.error('Erreur:', e);
                    }
                }
                return { email: reporterEmail, name: reporterName };
            });
            
            const defaultMessage = `Bonjour,\n\nNous vous remercions chaleureusement d'avoir signal√© des comportements inappropri√©s sur notre plateforme. Votre vigilance aide √† maintenir une communaut√© saine et respectueuse.\n\nMerci pour votre contribution !\n\nCordialement, L'√©quipe MangaWatch`;
            
            // Afficher la liste des rapporteurs dans le modal
            const recipientsList = reportersInfo.map(r => `${r.name} (${r.email})`).join(', ');
            showMessageInputModal('thank', recipientsList, reportersInfo, defaultMessage, async (message) => {
                if (message && message.trim()) {
                    await sendThankMessageToReporters(reportersInfo, message);
                    alert(`Message de remerciement envoy√© √† ${reportersInfo.length} rapporteur${reportersInfo.length > 1 ? 's' : ''} avec succ√®s.`);
                }
            });
        }
        
        // Fonction pour afficher le modal de saisie de message
        let currentMessageInputCallback = null;
        function showMessageInputModal(type, emailOrRecipientsList, nameOrReportersInfo, defaultMessage, callback) {
            const overlay = document.getElementById('message-input-modal-overlay');
            const modalIcon = document.getElementById('message-input-modal-icon');
            const modalTitle = document.getElementById('message-input-modal-title');
            const recipientSpan = document.getElementById('message-input-recipient');
            const textarea = document.getElementById('message-input-textarea');
            const confirmBtn = document.getElementById('message-input-modal-confirm');
            const cancelBtn = document.getElementById('message-input-modal-cancel');
            
            if (!overlay || !modalIcon || !modalTitle || !recipientSpan || !textarea || !confirmBtn || !cancelBtn) {
                // Fallback vers prompt si le modal n'existe pas
                const message = prompt(type === 'warning' 
                    ? `Envoyer un avertissement √† ${nameOrReportersInfo} (${emailOrRecipientsList}):\n\nEntrez le message d'avertissement:`
                    : `Remercier les rapporteurs:\n\nEntrez le message de remerciement:`, 
                    defaultMessage);
                if (message && callback) {
                    callback(message);
                }
                return;
            }
            
            // Stocker le callback
            currentMessageInputCallback = callback;
            
            // Configurer l'ic√¥ne et le titre selon le type
            if (type === 'warning') {
                modalIcon.className = 'custom-modal-icon warning';
                modalIcon.innerHTML = '<i class="fas fa-exclamation-triangle"></i>';
                modalTitle.textContent = 'Envoyer un avertissement';
                // Configurer le destinataire pour l'avertissement
                recipientSpan.textContent = `${nameOrReportersInfo} (${emailOrRecipientsList})`;
            } else if (type === 'thank') {
                modalIcon.className = 'custom-modal-icon success';
                modalIcon.innerHTML = '<i class="fas fa-heart"></i>';
                modalTitle.textContent = 'Remercier les rapporteurs';
                // Configurer le destinataire pour le remerciement (liste des rapporteurs)
                recipientSpan.textContent = emailOrRecipientsList;
            }
            
            // Remplir le textarea avec le message par d√©faut
            textarea.value = defaultMessage;
            
            // Supprimer les anciens event listeners
            const newConfirmBtn = confirmBtn.cloneNode(true);
            confirmBtn.parentNode.replaceChild(newConfirmBtn, confirmBtn);
            const finalConfirmBtn = document.getElementById('message-input-modal-confirm');
            
            const newCancelBtn = cancelBtn.cloneNode(true);
            cancelBtn.parentNode.replaceChild(newCancelBtn, cancelBtn);
            const finalCancelBtn = document.getElementById('message-input-modal-cancel');
            
            // Ajouter les nouveaux event listeners
            finalConfirmBtn.onclick = () => {
                const message = textarea.value.trim();
                if (currentMessageInputCallback) {
                    currentMessageInputCallback(message);
                    currentMessageInputCallback = null;
                }
                hideMessageInputModal();
            };
            
            finalCancelBtn.onclick = hideMessageInputModal;
            
            // Afficher le modal
            overlay.classList.add('active');
            textarea.focus();
        }
        
        function hideMessageInputModal() {
            const overlay = document.getElementById('message-input-modal-overlay');
            if (overlay) {
                overlay.classList.remove('active');
            }
            currentMessageInputCallback = null;
        }
        
        // Fermer le modal en cliquant sur l'overlay
        document.addEventListener('DOMContentLoaded', () => {
            const overlay = document.getElementById('message-input-modal-overlay');
            if (overlay) {
                overlay.addEventListener('click', (e) => {
                    if (e.target === overlay) {
                        hideMessageInputModal();
                    }
                });
            }
        });
        
        // G√©rer l'ignorance d'un signalement
        function handleIgnoreReport(userEmail) {
            const reports = getAllReports();
            const filteredReports = reports.filter(r => r.reportedUser !== userEmail);
            localStorage.setItem('user_reports', JSON.stringify(filteredReports));
            displayReports();
        }
        
        // Fonctions d'envoi de messages (√† utiliser avec messageService)
        async function sendBanMessage(email, name) {
            try {
                // Importer messageService dynamiquement
                const { messageService } = await import('/js/messageService.js');
                
                await messageService.sendMessage({
                    recipientEmail: email,
                    title: 'Votre compte a √©t√© banni',
                    content: `Bonjour ${name},\n\nVotre compte a √©t√© banni suite √† des signalements pour comportement inappropri√©.\n\nCette d√©cision est d√©finitive.\n\nCordialement, L'√©quipe MangaWatch`,
                    messageType: 'ban',
                    metadata: { reason: 'Signalements multiples' }
                });
            } catch (error) {
                console.error('Erreur lors de l\'envoi du message de bannissement:', error);
            }
        }
        
        async function sendWarningMessage(email, name, content) {
            try {
                const { messageService } = await import('/js/messageService.js');
                
                await messageService.sendMessage({
                    recipientEmail: email,
                    title: 'Avertissement',
                    content: content,
                    messageType: 'warning',
                    metadata: {}
                });
            } catch (error) {
                console.error('Erreur lors de l\'envoi du message d\'avertissement:', error);
            }
        }
        
        async function sendThankMessageToReporters(reportersInfo, content) {
            try {
                const { messageService } = await import('/js/messageService.js');
                
                // Envoyer le message √† tous les rapporteurs
                for (const reporter of reportersInfo) {
                    await messageService.sendMessage({
                        recipientEmail: reporter.email,
                        title: 'Merci pour vos signalements',
                        content: content,
                        messageType: 'thank',
                        metadata: {}
                    });
                }
            } catch (error) {
                console.error('Erreur lors de l\'envoi du message de remerciement:', error);
            }
        }
        
        // Ancienne fonction conserv√©e pour compatibilit√© (ne devrait plus √™tre utilis√©e)
        async function sendThankMessage(email, name, content) {
            await sendThankMessageToReporters([{ email, name }], content);
        }
        
        // Initialisation du formulaire de messagerie
        function initMessagingForm() {
            const recipientType = document.getElementById('message-recipient-type');
            const userSelectGroup = document.getElementById('user-select-group');
            const recipientUser = document.getElementById('message-recipient-user');
            const sendBtn = document.getElementById('send-message-btn');
            
            // Afficher/masquer la s√©lection d'utilisateur
            recipientType.addEventListener('change', () => {
                if (recipientType.value === 'user') {
                    userSelectGroup.style.display = 'block';
                    populateUserSelect();
                } else {
                    userSelectGroup.style.display = 'none';
                }
            });
            
            // Barre de recherche pour les utilisateurs
            const userSearchInput = document.getElementById('message-recipient-user-search');
            if (userSearchInput) {
                userSearchInput.addEventListener('input', (e) => {
                    const searchTerm = e.target.value.toLowerCase();
                    const options = recipientUser.querySelectorAll('option');
                    options.forEach(option => {
                        if (option.value === '') return; // Garder l'option par d√©faut
                        const text = option.textContent.toLowerCase();
                        option.style.display = text.includes(searchTerm) ? 'block' : 'none';
                    });
                });
            }
            
            // Populer la liste des utilisateurs
            function populateUserSelect() {
                const users = getAllUsers();
                recipientUser.innerHTML = '<option value="">Choisir un utilisateur...</option>';
                users.forEach(user => {
                    const option = document.createElement('option');
                    option.value = user.email;
                    option.textContent = `${user.name} (${user.email})`;
                    recipientUser.appendChild(option);
                });
            }

            // Mod√®les de messages pr√©d√©finis
            const templates = {
                'warning-harassment': {
                    type: 'warning',
                    title: 'Avertissement - Comportement inappropri√©',
                    content: 'Bonjour,\n\nVous avez re√ßu un avertissement suite √† des signalements pour comportement de harc√®lement ou toxicit√© sur notre plateforme.\n\nNous vous rappelons que notre communaut√© se doit d\'√™tre respectueuse et bienveillante envers tous les membres. Nous vous invitons √† revoir votre comportement et √† respecter les r√®gles de notre communaut√©.\n\nEn cas de r√©cidive, des sanctions plus s√©v√®res pourront √™tre appliqu√©es, pouvant aller jusqu\'au bannissement d√©finitif de votre compte.\n\nNous comptons sur votre compr√©hension et votre coop√©ration.\n\nCordialement,\nL\'√©quipe MangaWatch'
                },
                'warning-spam': {
                    type: 'warning',
                    title: 'Avertissement - Spam',
                    content: 'Bonjour,\n\nVous avez re√ßu un avertissement suite √† des signalements pour comportement de spam ou publicit√© non sollicit√©e sur notre plateforme.\n\nNous vous rappelons que la promotion de contenu ou services non autoris√©s est interdite sur MangaWatch. Merci de respecter les r√®gles de notre communaut√©.\n\nEn cas de r√©cidive, votre compte pourra √™tre suspendu ou banni.\n\nCordialement,\nL\'√©quipe MangaWatch'
                },
                'warning-inappropriate': {
                    type: 'warning',
                    title: 'Avertissement - Contenu inappropri√©',
                    content: 'Bonjour,\n\nVous avez re√ßu un avertissement suite √† des signalements pour publication de contenu offensant ou inappropri√© sur notre plateforme.\n\nNous vous rappelons que notre communaut√© se doit d\'√™tre respectueuse et appropri√©e pour tous les √¢ges. Merci de veiller √† ce que vos contributions respectent nos r√®gles de contenu.\n\nEn cas de r√©cidive, des sanctions pourront √™tre appliqu√©es.\n\nCordialement,\nL\'√©quipe MangaWatch'
                },
                'ban': {
                    type: 'ban',
                    title: 'Votre compte a √©t√© banni',
                    content: 'Bonjour,\n\nVotre compte a √©t√© banni d√©finitivement suite √† des violations r√©p√©t√©es de nos r√®gles de communaut√©.\n\nCette d√©cision a √©t√© prise apr√®s examen attentif de votre comportement et des signalements re√ßus concernant vos actions sur la plateforme.\n\nCette sanction est d√©finitive et irr√©versible.\n\nCordialement,\nL\'√©quipe MangaWatch'
                },
                'thank-report': {
                    type: 'thank',
                    title: 'Merci pour vos signalements',
                    content: 'Bonjour,\n\nNous tenions √† vous remercier chaleureusement d\'avoir signal√© des comportements inappropri√©s sur notre plateforme.\n\nVotre vigilance et votre contribution aident grandement √† maintenir une communaut√© saine, respectueuse et agr√©able pour tous nos membres. C\'est gr√¢ce √† des utilisateurs comme vous que nous pouvons garantir un environnement s√ªr et bienveillant.\n\nVotre action a permis de prendre les mesures n√©cessaires. Nous vous remercions sinc√®rement pour votre implication dans la qualit√© de notre communaut√©.\n\nN\'h√©sitez pas √† continuer √† nous signaler tout comportement qui vous semblerait inappropri√©.\n\nEncore merci !\n\nCordialement,\nL\'√©quipe MangaWatch'
                },
                'thank-report-ban': {
                    type: 'thank',
                    title: 'Merci pour votre signalement - Compte banni',
                    content: 'Bonjour,\n\nNous tenions √† vous remercier chaleureusement d\'avoir signal√© un utilisateur dont le comportement justifiait un bannissement sur notre plateforme.\n\nGr√¢ce √† votre vigilance et votre action, nous avons pu prendre les mesures n√©cessaires et bannir cet utilisateur, prot√©geant ainsi toute notre communaut√©.\n\nContinuez sur cette lanc√©e ! Votre engagement en faveur d\'une communaut√© saine et respectueuse est pr√©cieux. En r√©compense de votre implication, vous b√©n√©ficierez d\'avantages exclusifs sur le site ainsi que sur notre serveur Discord MangaWatch.\n\nNous vous remercions sinc√®rement pour votre contribution √† la qualit√© de notre communaut√©. N\'h√©sitez pas √† continuer √† nous signaler tout comportement inappropri√©.\n\nMerci encore pour votre vigilance !\n\nCordialement,\nL\'√©quipe MangaWatch'
                },
                'global-event': {
                    type: 'global',
                    title: 'Annonce importante',
                    content: 'Bonjour √† tous,\n\nNous avons le plaisir de vous annoncer un √©v√©nement sp√©cial sur MangaWatch !\n\nRestez connect√©s pour plus d\'informations dans les prochains jours.\n\nMerci de faire partie de notre communaut√© !\n\nCordialement,\nL\'√©quipe MangaWatch'
                },
                'share-site': {
                    type: 'global',
                    title: 'Partagez MangaWatch et obtenez des avantages exclusifs !',
                    content: 'Bonjour √† tous,\n\nNous avons besoin de votre aide pour faire conna√Ætre MangaWatch ! üöÄ\n\nSi vous appr√©ciez notre plateforme et souhaitez nous soutenir, nous vous encourageons vivement √† partager le site au maximum :\n\nüë• Avec votre entourage (famille, amis, coll√®gues, etc.)\nüì± Sur vos r√©seaux sociaux (Facebook, Instagram, TikTok, etc.)\nüí¨ Sur Discord\n\nüéÅ R√âCOMPENSE : Si vous partagez activement MangaWatch (avec votre entourage et/ou sur les r√©seaux) et que vous nous pr√©venez sur les r√©seaux sociaux ou sur notre serveur Discord, vous pourrez obtenir acc√®s √† des fonctionnalit√©s exclusives sur le site, notamment :\n\n‚ú® Certification de votre compte\n‚ú® Badges exclusifs\n‚ú® Acc√®s anticip√© aux nouvelles fonctionnalit√©s\n‚ú® Statut de membre privil√©gi√©\n\nüì± Comment nous pr√©venir ?\n- Partagez sur notre serveur Discord MangaWatch\n- Envoyez-nous un message via les r√©seaux sociaux\n\nVotre soutien est pr√©cieux pour faire grandir notre communaut√© ! Chaque partage compte et nous aide √† am√©liorer continuellement la plateforme.\n\nMerci infiniment pour votre engagement ! üôè\n\nCordialement,\nL\'√©quipe MangaWatch'
                }
            };

            // G√©rer les clics sur les mod√®les
            document.querySelectorAll('.template-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    const templateKey = btn.dataset.template;
                    const template = templates[templateKey];
                    if (template) {
                        document.getElementById('message-type').value = template.type;
                        document.getElementById('message-title').value = template.title;
                        document.getElementById('message-content').value = template.content;
                    }
                });
            });
            
            // Envoyer un message (utiliser onclick pour √©viter les doublons)
            let isSending = false;
            sendBtn.onclick = async () => {
                if (isSending) return;
                isSending = true;
                const recipientTypeValue = recipientType.value;
                const recipientEmail = recipientTypeValue === 'user' ? recipientUser.value : null;
                const messageType = document.getElementById('message-type').value;
                const title = document.getElementById('message-title').value.trim();
                const content = document.getElementById('message-content').value.trim();
                
                if (!title || !content) {
                    alert('Veuillez remplir le titre et le contenu du message.');
                    return;
                }
                
                if (recipientTypeValue === 'user' && !recipientEmail) {
                    alert('Veuillez s√©lectionner un utilisateur.');
                    return;
                }
                
                // Afficher le popup de confirmation
                const messageTypes = {
                    'info': { label: 'Information', icon: 'fa-info-circle', color: '#3498db' },
                    'warning': { label: 'Avertissement', icon: 'fa-exclamation-triangle', color: '#f39c12' },
                    'ban': { label: 'Bannissement', icon: 'fa-ban', color: '#e74c3c' },
                    'thank': { label: 'Remerciement', icon: 'fa-heart', color: '#2ecc71' },
                    'global': { label: 'Annonce globale', icon: 'fa-bullhorn', color: '#9b59b6' }
                };
                
                const type = messageTypes[messageType] || messageTypes.info;
                const recipientName = recipientTypeValue === 'user' && recipientEmail 
                    ? recipientUser.options[recipientUser.selectedIndex].textContent 
                    : 'Tous les utilisateurs';
                
                showSendMessageModal({
                    recipient: recipientName,
                    type: type.label,
                    typeIcon: type.icon,
                    title: title,
                    content: content.substring(0, 150) + (content.length > 150 ? '...' : ''),
                    fullContent: content
                }, async () => {
                    // Callback de confirmation
                    try {
                        const { messageService } = await import('/js/messageService.js');
                        
                        await messageService.sendMessage({
                            recipientEmail: recipientEmail,
                            title: title,
                            content: content,
                            messageType: messageType,
                            metadata: {}
                        });
                        
                        // Afficher un message de succ√®s
                        const successOverlay = document.getElementById('send-message-modal-overlay');
                        const modalBody = document.getElementById('send-message-modal-body');
                        const modalTitle = successOverlay.querySelector('.custom-modal-title');
                        const modalIcon = successOverlay.querySelector('.custom-modal-icon');
                        
                        modalIcon.className = 'custom-modal-icon success';
                        modalIcon.innerHTML = '<i class="fas fa-check-circle"></i>';
                        modalTitle.textContent = 'Message envoy√© avec succ√®s !';
                        modalBody.innerHTML = `
                            <div style="text-align: center; padding: 1rem 0;">
                                <p style="color: #00b894; font-size: 1.1rem; margin-bottom: 1rem;">
                                    <i class="fas fa-check-circle" style="font-size: 2rem; margin-bottom: 0.5rem; display: block;"></i>
                                    Votre message a √©t√© envoy√© avec succ√®s.
                                </p>
                                <p style="color: #aaa; font-size: 0.9rem;">
                                    Destinataire: <strong style="color: #00b894;">${recipientName}</strong><br>
                                    Type: <strong style="color: #00b894;">${type.label}</strong>
                                </p>
                            </div>
                        `;
                        
                        const confirmBtn = document.getElementById('send-message-modal-confirm');
                        confirmBtn.innerHTML = '<i class="fas fa-check"></i> OK';
                        confirmBtn.onclick = () => {
                            hideSendMessageModal();
                            // R√©initialiser le formulaire
                            document.getElementById('message-title').value = '';
                            document.getElementById('message-content').value = '';
                            recipientType.value = 'global';
                            userSelectGroup.style.display = 'none';
                            // R√©initialiser le bouton
                            confirmBtn.innerHTML = '<i class="fas fa-paper-plane"></i> Envoyer';
                            // R√©afficher le bouton annuler
                            document.getElementById('send-message-modal-cancel').style.display = 'flex';
                        };
                        
                        // Masquer le bouton annuler
                        document.getElementById('send-message-modal-cancel').style.display = 'none';
                        confirmBtn.style.display = 'block';
                        
                    } catch (error) {
                        console.error('Erreur lors de l\'envoi du message:', error);
                        hideSendMessageModal();
                        alert('Erreur lors de l\'envoi du message. Veuillez r√©essayer.');
                    }
                    isSending = false; // R√©initialiser le flag apr√®s l'envoi
                });
            };
        }
        
        // Fonction pour afficher le popup de confirmation d'envoi de message
        let currentSendMessageCallback = null;
        
        function showSendMessageModal(messageData, callback) {
            const overlay = document.getElementById('send-message-modal-overlay');
            const modalBody = document.getElementById('send-message-modal-body');
            const modalTitle = overlay.querySelector('.custom-modal-title');
            const modalIcon = overlay.querySelector('.custom-modal-icon');
            const cancelBtn = document.getElementById('send-message-modal-cancel');
            const confirmBtn = document.getElementById('send-message-modal-confirm');
            
            // R√©initialiser l'affichage
            cancelBtn.style.display = 'flex';
            confirmBtn.style.display = 'flex';
            confirmBtn.innerHTML = '<i class="fas fa-paper-plane"></i> Envoyer';
            
            // Stocker le callback
            currentSendMessageCallback = callback;
            
            // Configurer l'ic√¥ne et le titre
            modalIcon.className = 'custom-modal-icon success';
            modalIcon.innerHTML = '<i class="fas fa-paper-plane"></i>';
            modalTitle.textContent = 'Confirmer l\'envoi du message';
            
            // Configurer le contenu
            modalBody.innerHTML = `
                <div style="margin-bottom: 1rem;">
                    <p style="margin-bottom: 0.75rem;">
                        <strong style="color: #00b894;">Destinataire :</strong><br>
                        <span style="color: #ccc;">${messageData.recipient}</span>
                    </p>
                    <p style="margin-bottom: 0.75rem;">
                        <strong style="color: #00b894;">Type de message :</strong><br>
                        <span style="color: #ccc;"><i class="fas ${messageData.typeIcon}"></i> ${messageData.type}</span>
                    </p>
                    <p style="margin-bottom: 0.75rem;">
                        <strong style="color: #00b894;">Titre :</strong><br>
                        <span style="color: #ccc;">${messageData.title}</span>
                    </p>
                    <p>
                        <strong style="color: #00b894;">Aper√ßu du contenu :</strong><br>
                        <span style="color: #aaa; font-style: italic;">${messageData.content}</span>
                    </p>
                </div>
                <p style="color: #888; font-size: 0.9rem; text-align: center; margin-top: 1rem; padding-top: 1rem; border-top: 1px solid rgba(255,255,255,0.1);">
                    √ätes-vous s√ªr de vouloir envoyer ce message ?
                </p>
            `;
            
            // Supprimer les anciens event listeners pour √©viter les doublons
            const newConfirmBtn = confirmBtn.cloneNode(true);
            confirmBtn.parentNode.replaceChild(newConfirmBtn, confirmBtn);
            const finalConfirmBtn = document.getElementById('send-message-modal-confirm');
            
            // Supprimer tous les anciens listeners en cr√©ant un nouveau bouton
            finalConfirmBtn.onclick = () => {
                if (currentSendMessageCallback) {
                    currentSendMessageCallback();
                }
            };
            
            const newCancelBtn = cancelBtn.cloneNode(true);
            cancelBtn.parentNode.replaceChild(newCancelBtn, cancelBtn);
            const finalCancelBtn = document.getElementById('send-message-modal-cancel');
            finalCancelBtn.onclick = hideSendMessageModal;
            
            // Afficher le modal
            overlay.classList.add('active');
        }
        
        function hideSendMessageModal() {
            const overlay = document.getElementById('send-message-modal-overlay');
            overlay.classList.remove('active');
            currentSendMessageCallback = null;
        }
        
        // Fermer le modal en cliquant sur l'overlay
        document.addEventListener('DOMContentLoaded', () => {
            const overlay = document.getElementById('send-message-modal-overlay');
            if (overlay) {
                overlay.addEventListener('click', (e) => {
                    if (e.target === overlay) {
                        hideSendMessageModal();
                    }
                });
            }
        });
        
        // Initialisation
        document.addEventListener('DOMContentLoaded', () => {
            loadUsers();
            updateStats();
            displayReports();
            initMessagingForm();
            
            // Gestion de la recherche
            const searchInput = document.getElementById('user-search-input');
            const searchClear = document.getElementById('user-search-clear');
            
            // Afficher/masquer le bouton de suppression selon le contenu
            searchInput.addEventListener('input', () => {
                loadUsers();
                // Afficher le bouton de suppression si le champ n'est pas vide
                if (searchInput.value.trim().length > 0) {
                    searchClear.classList.add('visible');
                } else {
                    searchClear.classList.remove('visible');
                }
            });
            
            // Bouton pour effacer la recherche
            searchClear.addEventListener('click', () => {
                searchInput.value = '';
                searchClear.classList.remove('visible');
                loadUsers();
            });
        });
    </script>
</body>
</html>

